import psycopg2
import datetime as dt

def get_connection():
    return psycopg2.connect(
        database='Anemone Abangkuh', 
        user='postgres', 
        password='mega1234', 
        host='localhost', 
        port='5432'
    )

def login_admin():
    conn = get_connection()
    cur = conn.cursor()
    username = input("Username: ")
    password = input("Password: ")
    query = "SELECT * FROM pegawai WHERE username = %s AND password = %s"
    cur.execute(query, (username, password))
    admin = cur.fetchone()
    cur.close()
    conn.close()
    if admin:
        print("Login berhasil!")
        return admin
    else:
        print("Username atau password salah!")
        return None

def lihat_pelanggan():
    conn = get_connection()
    cur = conn.cursor()
    query = "SELECT * FROM pelanggan"
    cur.execute(query)
    pelanggan = cur.fetchall()
    cur.close()
    conn.close()
    for i in pelanggan:
        print(i)

def edit_data_pelanggan():
    pelanggan_id = input("Masukkan ID customer yang ingin diedit: ")
    conn = get_connection()
    cur = conn.cursor()
    nama = input("Nama baru: ")
    nomor = input("Nomor baru: ")
    alamat = input("Alamat baru: ")
    query = "UPDATE customer SET nama = %s, nomor = %s, alamat = %s WHERE id_pelanggan = %s"
    cur.execute(query, (nama, nomor, alamat, pelanggan_id))
    conn.commit()
    cur.close()
    conn.close()
    print("Data customer berhasil diperbarui!")

def lihat_transaksi():
    conn = get_connection()
    cur = conn.cursor()
    query = "SELECT * FROM transaksi"
    cur.execute(query)
    transaksi = cur.fetchall()
    cur.close()
    conn.close()
    
    formatted_transaksi = []
    for transaction in transaksi:
        formatted_transaction = tuple(
            elem.strftime("%Y-%m-%d") 
            if isinstance(elem, dt.date) 
            else elem
            for elem in transaction
        )
        formatted_transaksi.append(formatted_transaction)

    for transaction in formatted_transaksi:
        print(transaction)


def edit_transaksi():
    transaction_id = input("Masukkan ID transaksi yang ingin diedit: ")
    conn = get_connection()
    cur = conn.cursor()
    berat = float(input("Masukkan berat baru: "))
    query = "UPDATE transaksi SET ttl_brt = %s WHERE id_transaksi = %s"
    cur.execute(query, (berat, transaction_id))
    conn.commit()
    cur.close()
    conn.close()
    print("Data transaksi berhasil diperbarui!")

def logout():
    print("Anda telah log out.")


def menuAdmin():
        print('\nSelamat Datang Admin ! ')
        login_admin()
        # break 
        while True:
            print("Lanjutkan ke menu berikutnya.")
            print('1. Lihat Data Pelanggan')
            print('2. Edit Data Pelanggan')
            print('3. Lihat Data Transaksi')
            print('4. Edit Data Transaksi')
            print('5. Logout')
            pilihan = input('Pilih menu 1 - 5 : ')
            
            if pilihan == '1':
                lihat_pelanggan()
            elif pilihan == '2':
                edit_data_pelanggan()
            elif pilihan == '3':
                lihat_transaksi()
            elif pilihan == '4':
                edit_transaksi()
            elif pilihan == '5':
                logout()
            else:
                print("Pilihan tidak valid, silakan pilih angka 1 sampai 5")

menuAdmin()
